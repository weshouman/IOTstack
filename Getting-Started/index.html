
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Docker stack for getting started on IOT on the Raspberry PI">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.1">
    
    
      
        <title>Getting Started - IOTstack</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9299cb39.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IOTstack" class="md-header__button md-logo" aria-label="IOTstack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IOTstack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IOTstack" class="md-nav__button md-logo" aria-label="IOTstack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IOTstack
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        IOTStack Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Accessing-your-Device-from-the-internet/" class="md-nav__link">
        Accessing your device from the internet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Backup-and-Restore/" class="md-nav__link">
        Backing up and restoring IOTstack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../BuildStack-RandomPassword/" class="md-nav__link">
        Build Stack Random Services Password
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../BuildStack-Services/" class="md-nav__link">
        Build Stack Services system
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Contributing-Services/" class="md-nav__link">
        Contributing a service to IOTstack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Custom/" class="md-nav__link">
        Custom services and overriding default settings for IOTstack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Default-Configs/" class="md-nav__link">
        Build Stack Default Passwords for Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker-commands/" class="md-nav__link">
        Docker commands
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Getting Started
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-iotstack-videos" class="md-nav__link">
     introduction to IOTstack - videos 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
     assumptions 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-installation" class="md-nav__link">
     new installation 
  </a>
  
    <nav class="md-nav" aria-label=" new installation ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-recommended" class="md-nav__link">
     automatic (recommended) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
     manual 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scripted" class="md-nav__link">
     scripted 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-from-the-old-repo-gcgarner" class="md-nav__link">
     migrating from the old repo (gcgarner)? 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-system-patch" class="md-nav__link">
     recommended system patch 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-word-about-the-sudo-command" class="md-nav__link">
     a word about the sudo command 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-iotstack-menu" class="md-nav__link">
     the IOTstack menu 
  </a>
  
    <nav class="md-nav" aria-label=" the IOTstack menu ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#menu-item-install-docker-old-menu-only" class="md-nav__link">
     menu item: Install Docker  (old menu only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-build-stack" class="md-nav__link">
     menu item: Build Stack 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-docker-commands" class="md-nav__link">
     menu item: Docker commands 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-menu-items" class="md-nav__link">
     other menu items 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-menus" class="md-nav__link">
     switching menus 
  </a>
  
    <nav class="md-nav" aria-label=" switching menus ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-menu-master-branch" class="md-nav__link">
     current menu (master branch) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-menu-old-menu-branch" class="md-nav__link">
     old menu (old-menu branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-branch" class="md-nav__link">
     experimental branch 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands-docker-docker-compose" class="md-nav__link">
     useful commands: docker \&amp; docker-compose 
  </a>
  
    <nav class="md-nav" aria-label=" useful commands: docker \&amp; docker-compose ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-your-iotstack" class="md-nav__link">
     starting your IOTstack 
  </a>
  
    <nav class="md-nav" aria-label=" starting your IOTstack ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging-journald-errors" class="md-nav__link">
     logging journald errors 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-an-individual-container" class="md-nav__link">
     starting an individual container 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-your-iotstack" class="md-nav__link">
     stopping your IOTstack 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-an-individual-container" class="md-nav__link">
     stopping an individual container 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-container-status" class="md-nav__link">
     checking container status 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-container-logs" class="md-nav__link">
     viewing container logs 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-container" class="md-nav__link">
     restarting a container 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistent-data" class="md-nav__link">
     persistent data 
  </a>
  
    <nav class="md-nav" aria-label=" persistent data ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deleting-persistent-data" class="md-nav__link">
     deleting persistent data 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack-maintenance" class="md-nav__link">
     stack maintenance 
  </a>
  
    <nav class="md-nav" aria-label=" stack maintenance ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-raspberry-pi-os" class="md-nav__link">
     update Raspberry Pi OS 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-pull" class="md-nav__link">
     git pull 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-image-updates" class="md-nav__link">
     container image updates 
  </a>
  
    <nav class="md-nav" aria-label=" container image updates ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-images-not-built-from-dockerfiles" class="md-nav__link">
     updating images not built from Dockerfiles 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-images-built-from-dockerfiles" class="md-nav__link">
     updating images built from Dockerfiles 
  </a>
  
    <nav class="md-nav" aria-label=" updating images built from Dockerfiles ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-dockerfile-changes-local-image-only" class="md-nav__link">
     when Dockerfile changes (local image only) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-dockerhub-updates-base-and-local-images" class="md-nav__link">
     when DockerHub updates (base and local images) 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-unused-images" class="md-nav__link">
     deleting unused images 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-nuclear-option-use-with-caution" class="md-nav__link">
     the nuclear option - use with caution 
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Home/" class="md-nav__link">
        Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../How-the-script-works/" class="md-nav__link">
        How the script works
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Menu-System/" class="md-nav__link">
        Menu system
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Misc/" class="md-nav__link">
        Miscellaneous
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Native-RTL_433/" class="md-nav__link">
        Native RTL_433
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../New-Menu-Release-Notes/" class="md-nav__link">
        New IOTstack Menu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../PostBuild-Script/" class="md-nav__link">
        Postbuild BASH Script
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../RPIEasy_native/" class="md-nav__link">
        RPIEasy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Understanding-Containers/" class="md-nav__link">
        What is Docker?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Updating-the-Project/" class="md-nav__link">
        Updating the project
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gcgarner-migration/" class="md-nav__link">
        Migrating from gcgarner to SensorsIot
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_23" type="checkbox" id="__nav_23" >
      
      <label class="md-nav__link" for="__nav_23">
        Containers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_23">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Adminer/" class="md-nav__link">
        Adminer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Blynk_server/" class="md-nav__link">
        Blynk server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/DashMachine/" class="md-nav__link">
        DashMachine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/EspruinoHub/" class="md-nav__link">
        Espruinohub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Heimdall/" class="md-nav__link">
        Heimdall
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Home-Assistant/" class="md-nav__link">
        Home assistant
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Homer/" class="md-nav__link">
        Homer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/InfluxDB/" class="md-nav__link">
        InfluxDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MariaDB/" class="md-nav__link">
        MariaDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Mosquitto/" class="md-nav__link">
        Mosquitto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MotionEye/" class="md-nav__link">
        MotionEye
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/NextCloud/" class="md-nav__link">
        Next Cloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Node-RED/" class="md-nav__link">
        Node-RED
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Pi-hole/" class="md-nav__link">
        Pi-hole
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Plex/" class="md-nav__link">
        Plex
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-agent/" class="md-nav__link">
        Portainer agent
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-ce/" class="md-nav__link">
        Portainer CE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer/" class="md-nav__link">
        Portainer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/PostgreSQL/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/RTL_433-docker/" class="md-nav__link">
        RTL_433 Docker
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/TasmoAdmin/" class="md-nav__link">
        TasmoAdmin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/WireGuard/" class="md-nav__link">
        WireGuard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2MQTT/" class="md-nav__link">
        Zigbee2MQTT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2mqttassistant/" class="md-nav__link">
        Zigbee2Mqtt Assistant
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/deconz/" class="md-nav__link">
        deCONZ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/diyHue/" class="md-nav__link">
        DIY hue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/openHAB/" class="md-nav__link">
        Openhab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/x2go/" class="md-nav__link">
        x2go
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction-to-iotstack-videos" class="md-nav__link">
     introduction to IOTstack - videos 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
     assumptions 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-installation" class="md-nav__link">
     new installation 
  </a>
  
    <nav class="md-nav" aria-label=" new installation ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-recommended" class="md-nav__link">
     automatic (recommended) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual" class="md-nav__link">
     manual 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scripted" class="md-nav__link">
     scripted 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migrating-from-the-old-repo-gcgarner" class="md-nav__link">
     migrating from the old repo (gcgarner)? 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recommended-system-patch" class="md-nav__link">
     recommended system patch 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-word-about-the-sudo-command" class="md-nav__link">
     a word about the sudo command 
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-iotstack-menu" class="md-nav__link">
     the IOTstack menu 
  </a>
  
    <nav class="md-nav" aria-label=" the IOTstack menu ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#menu-item-install-docker-old-menu-only" class="md-nav__link">
     menu item: Install Docker  (old menu only)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-build-stack" class="md-nav__link">
     menu item: Build Stack 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#menu-item-docker-commands" class="md-nav__link">
     menu item: Docker commands 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-menu-items" class="md-nav__link">
     other menu items 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switching-menus" class="md-nav__link">
     switching menus 
  </a>
  
    <nav class="md-nav" aria-label=" switching menus ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#current-menu-master-branch" class="md-nav__link">
     current menu (master branch) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-menu-old-menu-branch" class="md-nav__link">
     old menu (old-menu branch)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experimental-branch" class="md-nav__link">
     experimental branch 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-commands-docker-docker-compose" class="md-nav__link">
     useful commands: docker \&amp; docker-compose 
  </a>
  
    <nav class="md-nav" aria-label=" useful commands: docker \&amp; docker-compose ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#starting-your-iotstack" class="md-nav__link">
     starting your IOTstack 
  </a>
  
    <nav class="md-nav" aria-label=" starting your IOTstack ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging-journald-errors" class="md-nav__link">
     logging journald errors 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-an-individual-container" class="md-nav__link">
     starting an individual container 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-your-iotstack" class="md-nav__link">
     stopping your IOTstack 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stopping-an-individual-container" class="md-nav__link">
     stopping an individual container 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-container-status" class="md-nav__link">
     checking container status 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#viewing-container-logs" class="md-nav__link">
     viewing container logs 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restarting-a-container" class="md-nav__link">
     restarting a container 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#persistent-data" class="md-nav__link">
     persistent data 
  </a>
  
    <nav class="md-nav" aria-label=" persistent data ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deleting-persistent-data" class="md-nav__link">
     deleting persistent data 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stack-maintenance" class="md-nav__link">
     stack maintenance 
  </a>
  
    <nav class="md-nav" aria-label=" stack maintenance ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-raspberry-pi-os" class="md-nav__link">
     update Raspberry Pi OS 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#git-pull" class="md-nav__link">
     git pull 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-image-updates" class="md-nav__link">
     container image updates 
  </a>
  
    <nav class="md-nav" aria-label=" container image updates ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-images-not-built-from-dockerfiles" class="md-nav__link">
     updating images not built from Dockerfiles 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updating-images-built-from-dockerfiles" class="md-nav__link">
     updating images built from Dockerfiles 
  </a>
  
    <nav class="md-nav" aria-label=" updating images built from Dockerfiles ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-dockerfile-changes-local-image-only" class="md-nav__link">
     when Dockerfile changes (local image only) 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-dockerhub-updates-base-and-local-images" class="md-nav__link">
     when DockerHub updates (base and local images) 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleting-unused-images" class="md-nav__link">
     deleting unused images 
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-nuclear-option-use-with-caution" class="md-nav__link">
     the nuclear option - use with caution 
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="getting-started">Getting Started</h1>
<h2 id="introduction-to-iotstack-videos"><a name="introAndVideos"> introduction to IOTstack - videos </a></h2>
<p>Andreas Spiess Video #295: Raspberry Pi Server based on Docker, with VPN, Dropbox backup, Influx, Grafana, etc: IOTstack</p>
<p><a href="https://www.youtube.com/watch?v=a6mjt8tWUws"><img alt="#295 Raspberry Pi Server based on Docker, with VPN, Dropbox backup, Influx, Grafana, etc: IOTstack" src="http://img.youtube.com/vi/a6mjt8tWUws/0.jpg" /></a></p>
<p>Andreas Spiess Video #352: Raspberry Pi4 Home Automation Server (incl. Docker, OpenHAB, HASSIO, NextCloud)</p>
<p><a href="https://www.youtube.com/watch?v=KJRMjUzlHI8"><img alt="#352 Raspberry Pi4 Home Automation Server (incl. Docker, OpenHAB, HASSIO, NextCloud)" src="http://img.youtube.com/vi/KJRMjUzlHI8/0.jpg" /></a></p>
<h2 id="assumptions"><a name="assumptions"> assumptions </a></h2>
<p>IOTstack makes the following assumptions:</p>
<ol>
<li>Your hardware is a Raspberry Pi (typically a 3B+ or 4B)</li>
<li>
<p>It has a reasonably-recent version of Raspberry Pi OS (aka "Raspbian" installed) which has been kept up-to-date with:</p>
<p><code>$ sudo apt update
$ sudo apt upgrade -y</code></p>
</li>
<li>
<p>You are logged-in as the user "pi"</p>
</li>
<li>User "pi" has the user ID 1000</li>
<li>The home directory for user "pi" is <code>/home/pi/</code></li>
<li>IOTstack is installed at <code>/home/pi/IOTstack</code> (with that exact spelling).</li>
</ol>
<p>The first five assumptions are Raspberry Pi defaults on a clean installation. The sixth is what you get if you follow these instructions faithfully.</p>
<blockquote>
<p>Please don't read these assumptions as saying that IOTstack will not run on other hardware, other operating systems, or as a different user. It is just that IOTstack gets most of its testing under these conditions. The further you get from these implicit assumptions, the more your mileage may vary.</p>
</blockquote>
<h2 id="new-installation"><a name="newInstallation"> new installation </a></h2>
<h3 id="automatic-recommended"><a name="autoInstall"> automatic (recommended) </a></h3>
<ol>
<li>
<p>Install <code>curl</code>:</p>
<p><code>$ sudo apt install -y curl</code></p>
</li>
<li>
<p>Run the following command:</p>
<p><code>$ curl -fsSL https://raw.githubusercontent.com/SensorsIot/IOTstack/master/install.sh | bash</code></p>
</li>
<li>
<p>Run the menu and choose your containers:</p>
<p><code>$ cd ~/IOTstack
$ ./menu.sh</code></p>
</li>
<li>
<p>Bring up your stack:</p>
<p><code>$ cd ~/IOTstack
$ docker-compose up -d</code></p>
</li>
</ol>
<h3 id="manual"><a name="manualInstall"> manual </a></h3>
<ol>
<li>
<p>Install <code>git</code>:</p>
<p><code>$ sudo apt install -y git</code></p>
</li>
<li>
<p>Clone IOTstack:</p>
<ul>
<li>
<p>If you want "new menu":</p>
<p><code>$ git clone https://github.com/SensorsIot/IOTstack.git ~/IOTstack</code></p>
</li>
<li>
<p>If you prefer "old menu":</p>
<p><code>$ git clone -b old-menu https://github.com/SensorsIot/IOTstack.git ~/IOTstack</code></p>
</li>
</ul>
</li>
<li>
<p>Run the menu and choose your containers:</p>
<p><code>$ cd ~/IOTstack
$ ./menu.sh</code></p>
<p>Note:</p>
<ul>
<li>If you are running "old menu" for the first time, you will be guided to "Install Docker". That will end in a reboot, after which you should re-enter the menu and choose your containers.</li>
</ul>
</li>
<li>
<p>Bring up your stack:</p>
<p><code>$ cd ~/IOTstack
$ docker-compose up -d</code></p>
</li>
</ol>
<h3 id="scripted"><a name="scriptedInstall"> scripted </a></h3>
<p>If you prefer to automate your installations using scripts, see:</p>
<ul>
<li><a href="https://gist.github.com/Paraphraser/d119ae81f9e60a94e1209986d8c9e42f#scripting-iotstack-installations">Installing Docker for IOTstack</a>.</li>
</ul>
<h2 id="migrating-from-the-old-repo-gcgarner"><a name="gcgarnerMigrate"> migrating from the old repo (gcgarner)? </a></h2>
<p>If you are still running on gcgarner/IOTstack and need to migrate to SensorsIot/IOTstack, see:</p>
<ul>
<li><a href="../gcgarner-migration/">Migrating IOTstack from gcgarner to SensorsIot</a>.</li>
</ul>
<h2 id="recommended-system-patch"><a name="recommendedPatches"> recommended system patch </a></h2>
<p>Run the following commands:</p>
<pre><code>$ sudo bash -c '[ $(egrep -c &quot;^allowinterfaces eth0,wlan0&quot; /etc/dhcpcd.conf) -eq 0 ] &amp;&amp; echo &quot;allowinterfaces eth0,wlan0&quot; &gt;&gt; /etc/dhcpcd.conf'
$ sudo reboot
</code></pre>
<p>See <a href="https://github.com/SensorsIot/IOTstack/issues/219">Issue 219</a> and <a href="https://github.com/SensorsIot/IOTstack/issues/253">Issue 253</a> for more information.</p>
<h2 id="a-word-about-the-sudo-command"><a name="aboutSudo"> a word about the <code>sudo</code> command </a></h2>
<p>Many first-time users of IOTstack get into difficulty by misusing the <code>sudo</code> command. The problem is best understood by example. In the following, you would expect <code>~</code> (tilde) to expand to <code>/home/pi</code>. It does:</p>
<pre><code>$ echo ~/IOTstack
/home/pi/IOTstack
</code></pre>
<p>The command below sends the same <code>echo</code> command to <code>bash</code> for execution. This is what happens when you type the name of a shell script. You get a new instance of <code>bash</code> to run the script:</p>
<pre><code>$ bash -c 'echo ~/IOTstack'
/home/pi/IOTstack
</code></pre>
<p>Same answer. Again, this is what you expect. But now try it with <code>sudo</code> on the front:</p>
<pre><code>$ sudo bash -c 'echo ~/IOTstack'
/root/IOTstack
</code></pre>
<p>Different answer. It is different because <code>sudo</code> means "become root, and then run the command". The process of becoming root changes the home directory, and that changes the definition of <code>~</code>.</p>
<p>Any script designed for working with IOTstack assumes <code>~</code> (or the equivalent <code>$HOME</code> variable) expands to <code>/home/pi</code>. That assumption is invalidated if the script is run by <code>sudo</code>.</p>
<p>Of necessity, any script designed for working with IOTstack will have to invoke <code>sudo</code> <strong>inside</strong> the script <strong>when it is required</strong>. You do not need to second-guess the script's designer.</p>
<p>Please try to minimise your use of <code>sudo</code> when you are working with IOTstack. Here are some rules of thumb:</p>
<ol>
<li>
<p>Is what you are about to run a script? If yes, check whether the script already contains <code>sudo</code> commands. Using <code>menu.sh</code> as the example:</p>
<p><code>$ grep -c 'sudo' ~/IOTstack/menu.sh
28</code></p>
<p>There are numerous uses of <code>sudo</code> within <code>menu.sh</code>. That means the designer thought about when <code>sudo</code> was needed.</p>
</li>
<li>
<p>Did the command you <strong>just executed</strong> work without <code>sudo</code>? Note the emphasis on the past tense. If yes, then your work is done. If no, and the error suggests elevated privileges are necessary, then re-execute the last command like this:</p>
<p><code>$ sudo !!</code></p>
</li>
</ol>
<p>It takes time, patience and practice to learn when <code>sudo</code> is <strong>actually</strong> needed. Over-using <code>sudo</code> out of habit, or because you were following a bad example you found on the web, is a very good way to find that you have created so many problems for yourself that will need to reinstall your IOTstack. <em>Please</em> err on the side of caution!</p>
<h2 id="the-iotstack-menu"><a name="theMenu"> the IOTstack menu </a></h2>
<p>The menu is used to install Docker and then build the <code>docker-compose.yml</code> file which is necessary for starting the stack.</p>
<blockquote>
<p>The menu is only an aid. It is a good idea to learn the <code>docker</code> and <code>docker-compose</code> commands if you plan on using Docker in the long run.</p>
</blockquote>
<h3 id="menu-item-install-docker-old-menu-only"><a name="menuInstallDocker"> menu item: Install Docker </a> (old menu only)</h3>
<p>Please do <strong>not</strong> try to install <code>docker</code> and <code>docker-compose</code> via <code>sudo apt install</code>. There's more to it than that. Docker needs to be installed by <code>menu.sh</code>. The menu will prompt you to install docker if it detects that docker is not already installed. You can manually install it from within the <code>Native Installs</code> menu:</p>
<pre><code>$ cd ~/IOTstack
$ ./menu.sh
Select &quot;Native Installs&quot;
Select &quot;Install Docker and Docker-Compose&quot;
</code></pre>
<p>Follow the prompts. The process finishes by asking you to reboot. Do that!</p>
<p>Note:</p>
<ul>
<li>New menu (master branch) automates this step.</li>
</ul>
<h3 id="menu-item-build-stack"><a name="menuBuildStack"> menu item: Build Stack </a></h3>
<p><code>docker-compose</code> uses a <code>docker-compose.yml</code> file to configure all your services. The <code>docker-compose.yml</code> file is created by the menu:</p>
<pre><code>$ cd ~/IOTstack
$ ./menu.sh
Select &quot;Build Stack&quot;
</code></pre>
<p>Follow the on-screen prompts and select the containers you need.</p>
<blockquote>
<p>The best advice we can give is "start small". Limit yourself to the core containers you actually need (eg Mosquitto, Node-RED, InfluxDB, Grafana, Portainer). You can always add more containers later. Some users have gone overboard with their initial selections and have run into what seem to be Raspberry Pi OS limitations.</p>
</blockquote>
<p>Key point:</p>
<ul>
<li>If you are running "new menu" (master branch) and you select Node-RED, you <strong>must</strong> press the right-arrow and choose at least one add-on node. If you skip this step, Node-RED will not build properly.</li>
<li>Old menu forces you to choose add-on nodes for Node-RED.</li>
</ul>
<p>The process finishes by asking you to bring up the stack:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up -d
</code></pre>
<p>The first time you run <code>up</code> the stack docker will download all the images from DockerHub. How long this takes will depend on how many containers you selected and the speed of your internet connection.</p>
<p>Some containers also need to be built locally. Node-RED is an example. Depending on the Node-RED nodes you select, building the image can also take a very long time. This is especially true if you select the SQLite node.</p>
<p>Be patient (and ignore the huge number of warnings).</p>
<h3 id="menu-item-docker-commands"><a name="menuDockerCommands"> menu item: Docker commands </a></h3>
<p>The commands in this menu execute shell scripts in the root of the project.</p>
<h3 id="other-menu-items"><a name="otherMenuItems"> other menu items </a></h3>
<p>The old and new menus differ in the options they offer. You should come back and explore them once your stack is built and running.</p>
<h2 id="switching-menus"><a name="switchingMenus"> switching menus </a></h2>
<h3 id="current-menu-master-branch"><a name="menuMasterBranch"> current menu (master branch) </a></h3>
<pre><code>$ cd ~/IOTstack/
$ git pull
$ git checkout master
$ ./menu.sh
</code></pre>
<h3 id="old-menu-old-menu-branch"><a name="menuOldMenuBranch"> old menu (old-menu branch)</a></h3>
<pre><code>$ cd ~/IOTstack/
$ git pull
$ git checkout old-menu
$ ./menu.sh
</code></pre>
<h3 id="experimental-branch"><a name="menuExperimentalBranch"> experimental branch </a></h3>
<p>Switch to the experimental branch to try the latest and greatest features.</p>
<pre><code>$ cd ~/IOTstack/
$ git pull
$ git checkout experimental
$ ./menu.sh
</code></pre>
<p>Notes:</p>
<ul>
<li>Please make sure you have a good backup before you start.</li>
<li>The experimental branch may be broken, or may break your setup.</li>
<li>Please report any issues.</li>
<li>
<p>Remember:</p>
<ul>
<li>you can switch git branches as much as you like without breaking anything.</li>
<li>simply launching the menu (any version) won't change anything providing you exit before letting the menu complete.</li>
<li>running the menu <em>to completion</em> <strong>will</strong> change your docker-compose.yml and supporting structures in <code>~/IOTstack/services</code>.</li>
<li>running <code>docker-compose up -d</code> will change your running containers.</li>
</ul>
</li>
<li>
<p>The way back is to take down your stack, restore a backup, and bring up your stack again.</p>
</li>
</ul>
<h2 id="useful-commands-docker-docker-compose"><a name="dockerAndCompose"> useful commands: docker \&amp; docker-compose </a></h2>
<p>Handy rules:</p>
<ul>
<li><code>docker</code> commands can be executed from anywhere, but</li>
<li><code>docker-compose</code> commands need to be executed from within <code>~/IOTstack</code></li>
</ul>
<h3 id="starting-your-iotstack"><a name="upIOTstack"> starting your IOTstack </a></h3>
<p>To start the stack:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up -d
</code></pre>
<p>Once the stack has been brought up, it will stay up until you take it down. This includes shutdowns and reboots of your Raspberry Pi. If you do not want the stack to start automatically after a reboot, you need to stop the stack before you issue the reboot command.</p>
<h4 id="logging-journald-errors"><a name="journaldErrors"> logging journald errors </a></h4>
<p>If you get docker logging error like:</p>
<pre><code>Cannot create container for service [service name here]: unknown log opt 'max-file' for journald log driver
</code></pre>
<ol>
<li>
<p>Run the command:</p>
<p><code>sudo nano /etc/docker/daemon.json</code></p>
</li>
<li>
<p>change:</p>
<p><code>"log-driver": "journald",</code></p>
<p>to:</p>
<p><code>"log-driver": "json-file",</code></p>
</li>
</ol>
<p>Logging limits were added to prevent Docker using up lots of RAM if log2ram is enabled, or SD cards being filled with log data and degraded from unnecessary IO. See <a href="https://docs.docker.com/config/containers/logging/configure/">Docker Logging configurations</a></p>
<p>You can also turn logging off or set it to use another option for any service by using the IOTstack <code>docker-compose-override.yml</code> file mentioned at <a href="https://sensorsiot.github.io/IOTstack/Custom/">IOTstack/Custom</a>.</p>
<h3 id="starting-an-individual-container"><a name="upContainer"> starting an individual container </a></h3>
<p>To start the stack:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up -d «container»
</code></pre>
<h3 id="stopping-your-iotstack"><a name="downIOTstack"> stopping your IOTstack </a></h3>
<p>Stopping aka "downing" the stack stops and deletes all containers, and removes the internal network:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose down
</code></pre>
<p>To stop the stack without removing containers, run:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose stop
</code></pre>
<h3 id="stopping-an-individual-container"><a name="downContainer"> stopping an individual container </a></h3>
<p><code>stop</code> can also be used to stop individual containers, like this:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose stop «container»
</code></pre>
<p>This puts the container in a kind of suspended animation. You can resume the container with </p>
<pre><code>$ cd ~/IOTstack
$ docker-compose start «container»
</code></pre>
<p>There is no equivalent of <code>down</code> for a single container. It needs two commands:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose stop «container»
$ docker-compose rm -f «container»
</code></pre>
<p>To reactivate a container which has been stopped and removed:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up -d «container»
</code></pre>
<h3 id="checking-container-status"><a name="dockerPS"> checking container status </a></h3>
<p>You can check the status of containers with:</p>
<pre><code>$ docker ps
</code></pre>
<p>or</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose ps
</code></pre>
<h3 id="viewing-container-logs"><a name="dockerLogs"> viewing container logs </a></h3>
<p>You can inspect the logs of most containers like this:</p>
<pre><code>$ docker logs «container»
</code></pre>
<p>for example:</p>
<pre><code>$ docker logs nodered
</code></pre>
<p>You can also follow a container's log as new entries are added by using the <code>-f</code> flag:</p>
<pre><code>$ docker logs -f nodered
</code></pre>
<p>Terminate with a Control+C. Note that restarting a container will also terminate a followed log.</p>
<h3 id="restarting-a-container"><a name="restartContainer"> restarting a container </a></h3>
<p>You can restart a container in several ways:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose restart «container»
</code></pre>
<p>This kind of restart is the least-powerful form of restart. A good way to think of it is "the container is only restarted, it is not rebuilt".</p>
<p>If you change a <code>docker-compose.yml</code> setting for a container and/or an environment variable file referenced by <code>docker-compose.yml</code> then a <code>restart</code> is usually not enough to bring the change into effect. You need to make <code>docker-compose</code> notice the change:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up -d «container»
</code></pre>
<p>This type of "restart" rebuilds the container.</p>
<p>Alternatively, to force a container to rebuild (without changing either <code>docker-compose.yml</code> or an environment variable file):</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose stop «container»
$ docker-compose rm -f «container»
$ docker-compose up -d «container»
</code></pre>
<p>See also <a href="#updateDockerfile">updating images built from Dockerfiles</a> if you need to force <code>docker-compose</code> to notice a change to a Dockerfile.</p>
<h2 id="persistent-data"><a name="persistentStore"> persistent data </a></h2>
<p>Docker allows a container's designer to map folders inside a container to a folder on your disk (SD, SSD, HD). This is done with the "volumes" key in <code>docker-compose.yml</code>. Consider the following snippet for Node-RED:</p>
<pre><code>volumes:
  - ./volumes/nodered/data:/data
</code></pre>
<p>You read this as two paths, separated by a colon. The:</p>
<ul>
<li>external path is <code>./volumes/nodered/data</code></li>
<li>internal path is <code>/data</code></li>
</ul>
<p>In this context, the leading "." means "the folder containing <code>docker-compose.yml</code>", so the external path is actually:</p>
<ul>
<li><code>~/IOTstack/volumes/nodered/data</code></li>
</ul>
<p>If a process running <strong>inside</strong> the container modifies any file or folder within:</p>
<pre><code>/data
</code></pre>
<p>the change is mirrored <strong>outside</strong> the container at the same relative path within:</p>
<pre><code>~/IOTstack/volumes/nodered/data
</code></pre>
<p>The same is true in reverse. Any change made to any file or folder <strong>outside</strong> the container within:</p>
<pre><code>~/IOTstack/volumes/nodered/data
</code></pre>
<p>is mirrored at the same relative path <strong>inside</strong> the container at:</p>
<pre><code>/data
</code></pre>
<h3 id="deleting-persistent-data"><a name="deletePersistentStore"> deleting persistent data </a></h3>
<p>If you need a "clean slate" for a container, you can delete its volumes. Using InfluxDB as an example:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose stop influxdb
$ sudo rm -rf ./volumes/influxdb
$ docker-compose up -d influxdb
</code></pre>
<p>When <code>docker-compose</code> tries to bring up InfluxDB, it will notice this volume mapping in <code>docker-compose.yml</code>:</p>
<pre><code>    volumes:
      - ./volumes/influxdb/data:/var/lib/influxdb
</code></pre>
<p>and check to see whether <code>./volumes/influxdb/data</code> is present. Finding it not there, it does the equivalent of:</p>
<pre><code>$ sudo mkdir -p ./volumes/influxdb/data
</code></pre>
<p>When InfluxDB starts, it sees that the folder on right-hand-side of the volumes mapping (<code>/var/lib/influxdb</code>) is empty and initialises new databases.</p>
<p>This is how <strong>most</strong> containers behave. But there are exceptions. A good example of an exception is Mosquitto which does not re-initialise correctly so you should avoid removing its persistent store.</p>
<h2 id="stack-maintenance"><a name="stackMaintenance"> stack maintenance </a></h2>
<h3 id="update-raspberry-pi-os"><a name="raspbianUpdates"> update Raspberry Pi OS </a></h3>
<p>You should keep your Raspberry Pi up-to-date. Despite the word "container" suggesting that <em>containers</em> are fully self-contained, they sometimes depend on operating system components ("WireGuard" is an example).</p>
<pre><code>$ sudo apt update
$ sudo apt upgrade -y
</code></pre>
<h3 id="git-pull"><a name="gitUpdates"> git pull </a></h3>
<p>Although the menu will generally do this for you, it does not hurt to keep your local copy of the IOTstack repository in sync with the master version on GitHub.</p>
<pre><code>$ cd ~/IOTstack
$ git pull
</code></pre>
<h3 id="container-image-updates"><a name="imageUpdates"> container image updates </a></h3>
<p>There are two kinds of images used in IOTstack:</p>
<ul>
<li>Those not built using Dockerfiles (the majority)</li>
<li>
<p>Those built using Dockerfiles (special cases)</p>
<blockquote>
<p>A Dockerfile is a set of instructions designed to customise an image before it is instantiated to become a running container.</p>
</blockquote>
</li>
</ul>
<p>The easiest way to work out which type of image you are looking at is to inspect the container's service definition in your <code>docker-compose.yml</code> file. If the service definition contains the:</p>
<ul>
<li><code>image:</code> keyword then the image is <strong>not</strong> built using a Dockerfile.</li>
<li><code>build:</code> keyword then the image <strong>is</strong> built using a Dockerfile. </li>
</ul>
<h4 id="updating-images-not-built-from-dockerfiles"><a name="updateNonDockerfile"> updating images not built from Dockerfiles </a></h4>
<p>If new versions of this type of image become available on DockerHub, your local IOTstack copies can be updated by a <code>pull</code> command:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose pull
$ docker-compose up -d
$ docker system prune
</code></pre>
<p>The <code>pull</code> downloads any new images. It does this without disrupting the running stack.</p>
<p>The <code>up -d</code> notices any newly-downloaded images, builds new containers, and swaps old-for-new. There is barely any downtime for affected containers.</p>
<h4 id="updating-images-built-from-dockerfiles"><a name="updateDockerfile"> updating images built from Dockerfiles </a></h4>
<p>Containers built using Dockerfiles have a two-step process:</p>
<ol>
<li>A <em>base</em> image is downloaded from from DockerHub; and then</li>
<li>The Dockerfile "runs" to build a <em>local</em> image.</li>
</ol>
<p>Node-RED is a good example of a container built from a Dockerfile. The Dockerfile defines some (or possibly all) of your add-on nodes, such as those needed for InfluxDB or Tasmota.</p>
<p>There are two separate update situations that you need to consider:</p>
<ul>
<li>If your Dockerfile changes; or</li>
<li>If a newer base image appears on DockerHub</li>
</ul>
<p>Node-RED also provides a good example of why your Dockerfile might change: if you decide to add or remove add-on nodes.</p>
<p>Note:</p>
<ul>
<li>You can also add nodes to Node-RED using Manage Palette. </li>
</ul>
<h5 id="when-dockerfile-changes-local-image-only"><a name="buildDockerfile"> when Dockerfile changes (<em>local</em> image only) </a></h5>
<p>When your Dockerfile changes, you need to rebuild like this:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose up --build -d «container»
$ docker system prune
</code></pre>
<p>This only rebuilds the <em>local</em> image and, even then, only if <code>docker-compose</code> senses a <em>material</em> change to the Dockerfile.</p>
<p>If you are trying to force the inclusion of a later version of an add-on node, you need to treat it like a <a href="#rebuildDockerfile">DockerHub update</a>.</p>
<p>Key point:</p>
<ul>
<li>The <em>base</em> image is not affected by this type of update.</li>
</ul>
<p>Note:</p>
<ul>
<li>
<p>You can also use this type of build if you get an error after modifying Node-RED's environment:</p>
<p><code>$ cd ~/IOTstack
$ docker-compose up --build -d nodered</code></p>
</li>
</ul>
<h5 id="when-dockerhub-updates-base-and-local-images"><a name="rebuildDockerfile"> when DockerHub updates (<em>base</em> and <em>local</em> images) </a></h5>
<p>When a newer version of the <em>base</em> image appears on DockerHub, you need to rebuild like this:</p>
<pre><code>$ cd ~/IOTstack
$ docker-compose build --no-cache --pull «container»
$ docker-compose up -d «container»
$ docker system prune
</code></pre>
<p>This causes DockerHub to be checked for the later version of the <em>base</em> image, downloading it as needed.</p>
<p>Then, the Dockerfile is run to produce a new <em>local</em> image. The Dockerfile run happens even if a new <em>base</em> image was not downloaded in the previous step.</p>
<h3 id="deleting-unused-images"><a name="dockerPrune"> deleting unused images </a></h3>
<p>As your system evolves and new images come down from DockerHub, you may find that more disk space is being occupied than you expected. Try running:</p>
<pre><code>$ docker system prune
</code></pre>
<p>This recovers anything no longer in use.</p>
<p>If you add a container via <code>menu.sh</code> and later remove it (either manually or via <code>menu.sh</code>), the associated images(s) will probably persist. You can check which images are installed via:</p>
<pre><code>$ docker images

REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
influxdb                 latest              1361b14bf545        5 days ago          264MB
grafana/grafana          latest              b9dfd6bb8484        13 days ago         149MB
iotstack_nodered         latest              21d5a6b7b57b        2 weeks ago         540MB
portainer/portainer-ce   latest              5526251cc61f        5 weeks ago         163MB
eclipse-mosquitto        latest              4af162db6b4c        6 weeks ago         8.65MB
nodered/node-red         latest              fa3bc6f20464        2 months ago        376MB
portainer/portainer      latest              dbf28ba50432        2 months ago        62.5MB
</code></pre>
<p>Both "Portainer CE" and "Portainer" are in that list. Assuming "Portainer" is no longer in use, it can be removed by using either its repository name or its Image ID. In other words, the following two commands are synonyms:</p>
<pre><code>$ docker rmi portainer/portainer
$ docker rmi dbf28ba50432
</code></pre>
<p>In general, you can use the repository name to remove an image but the Image ID is sometimes needed. The most common situation where you are likely to need the Image ID is after an image has been updated on DockerHub and pulled down to your Raspberry Pi. You will find two containers with the same name. One will be tagged "latest" (the running version) while the other will be tagged "<none>" (the prior version). You use the Image ID to resolve the ambiguity.</p>
<h2 id="the-nuclear-option-use-with-caution"><a name="nuclearOption"> the nuclear option - use with caution </a></h2>
<p>You can use Git to delete all files and folders to return your folder to the freshly cloned state.</p>
<p>Warning: <strong>YOU WILL LOSE ALL YOUR DATA</strong>.</p>
<pre><code>$ cd ~/IOTstack
$ sudo git clean -d -x -f
</code></pre>
<p>This is probably the <strong>only</strong> time you should ever need to use <code>sudo</code> in conjunction with <code>git</code> for IOTstack. This is not recoverable!</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Docker-commands/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Docker commands
            </div>
          </div>
        </a>
      
      
        <a href="../Home/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Wiki
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.7353b375.min.js"></script>
      
    
  </body>
</html>