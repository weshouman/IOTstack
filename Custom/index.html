
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Docker stack for getting started on IOT on the Raspberry PI">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.1">
    
    
      
        <title>Custom services and overriding default settings for IOTstack - IOTstack</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.9299cb39.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#custom-services-and-overriding-default-settings-for-iotstack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IOTstack" class="md-header__button md-logo" aria-label="IOTstack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IOTstack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Custom services and overriding default settings for IOTstack
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IOTstack" class="md-nav__button md-logo" aria-label="IOTstack" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IOTstack
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        IOTStack Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Accessing-your-Device-from-the-internet/" class="md-nav__link">
        Accessing your device from the internet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Backup-and-Restore/" class="md-nav__link">
        Backing up and restoring IOTstack
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../BuildStack-RandomPassword/" class="md-nav__link">
        Build Stack Random Services Password
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../BuildStack-Services/" class="md-nav__link">
        Build Stack Services system
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Contributing-Services/" class="md-nav__link">
        Contributing a service to IOTstack
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Custom services and overriding default settings for IOTstack
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Custom services and overriding default settings for IOTstack
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-word-of-caution" class="md-nav__link">
    A word of caution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overriding-default-settings" class="md-nav__link">
    Overriding default settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-env-files-instead-of-docker-compose-variables" class="md-nav__link">
    Using env files instead of docker-compose variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-custom-services" class="md-nav__link">
    Adding custom services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Default-Configs/" class="md-nav__link">
        Build Stack Default Passwords for Services
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker-commands/" class="md-nav__link">
        Docker commands
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Getting-Started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Home/" class="md-nav__link">
        Wiki
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../How-the-script-works/" class="md-nav__link">
        How the script works
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Menu-System/" class="md-nav__link">
        Menu system
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Misc/" class="md-nav__link">
        Miscellaneous
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Native-RTL_433/" class="md-nav__link">
        Native RTL_433
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Networking/" class="md-nav__link">
        Networking
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../New-Menu-Release-Notes/" class="md-nav__link">
        New IOTstack Menu
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../PostBuild-Script/" class="md-nav__link">
        Postbuild BASH Script
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../RPIEasy_native/" class="md-nav__link">
        RPIEasy
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Understanding-Containers/" class="md-nav__link">
        What is Docker?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Updating-the-Project/" class="md-nav__link">
        Updating the project
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gcgarner-migration/" class="md-nav__link">
        Migrating from gcgarner to SensorsIot
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_23" type="checkbox" id="__nav_23" >
      
      <label class="md-nav__link" for="__nav_23">
        Containers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Containers" data-md-level="1">
        <label class="md-nav__title" for="__nav_23">
          <span class="md-nav__icon md-icon"></span>
          Containers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Adminer/" class="md-nav__link">
        Adminer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Blynk_server/" class="md-nav__link">
        Blynk server
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/DashMachine/" class="md-nav__link">
        DashMachine
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/EspruinoHub/" class="md-nav__link">
        Espruinohub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Heimdall/" class="md-nav__link">
        Heimdall
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Home-Assistant/" class="md-nav__link">
        Home assistant
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Homer/" class="md-nav__link">
        Homer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/InfluxDB/" class="md-nav__link">
        InfluxDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MariaDB/" class="md-nav__link">
        MariaDB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Mosquitto/" class="md-nav__link">
        Mosquitto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/MotionEye/" class="md-nav__link">
        MotionEye
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/NextCloud/" class="md-nav__link">
        Next Cloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Node-RED/" class="md-nav__link">
        Node-RED
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Pi-hole/" class="md-nav__link">
        Pi-hole
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Plex/" class="md-nav__link">
        Plex
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-agent/" class="md-nav__link">
        Portainer agent
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer-ce/" class="md-nav__link">
        Portainer CE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Portainer/" class="md-nav__link">
        Portainer
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/PostgreSQL/" class="md-nav__link">
        PostgreSQL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/RTL_433-docker/" class="md-nav__link">
        RTL_433 Docker
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/TasmoAdmin/" class="md-nav__link">
        TasmoAdmin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/WireGuard/" class="md-nav__link">
        WireGuard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2MQTT/" class="md-nav__link">
        Zigbee2MQTT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/Zigbee2mqttassistant/" class="md-nav__link">
        Zigbee2Mqtt Assistant
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/deconz/" class="md-nav__link">
        deCONZ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/diyHue/" class="md-nav__link">
        DIY hue
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/openHAB/" class="md-nav__link">
        Openhab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../Containers/x2go/" class="md-nav__link">
        x2go
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-word-of-caution" class="md-nav__link">
    A word of caution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overriding-default-settings" class="md-nav__link">
    Overriding default settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-env-files-instead-of-docker-compose-variables" class="md-nav__link">
    Using env files instead of docker-compose variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-custom-services" class="md-nav__link">
    Adding custom services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="custom-services-and-overriding-default-settings-for-iotstack">Custom services and overriding default settings for IOTstack</h1>
<p>You can specify modifcations to the <code>docker-compose.yml</code> file, including your own networks and custom containers/services.</p>
<p>Create a file called <code>compose-override.yml</code> in the main directory, and place your modifications into it. These changes will be merged into the <code>docker-compose.yml</code> file next time you run the build script.</p>
<p>The <code>compose-override.yml</code> file has been added to the <code>.gitignore</code> file, so it shouldn't be touched when upgrading IOTstack. It has been added to the backup script, and so will be included when you back up and restore IOTstack. Always test your backups though! New versions of IOTstack may break previous builds.</p>
<h2 id="how-it-works">How it works</h2>
<ol>
<li>After the build process has been completed, a temporary docker compose file is created in the <code>tmp</code> directory.</li>
<li>The script then checks if <code>compose-override.yml</code> exists:<ul>
<li>If it exists, then continue to step <code>3</code></li>
<li>If it does not exist, copy the temporary docker compose file to the main directory and rename it to <code>docker-compose.yml</code>.</li>
</ul>
</li>
<li>Using the <code>yaml_merge.py</code> script, merge both the <code>compose-override.yml</code> and the temporary docker compose file together; Using the temporary file as the default values and interating through each level of the yaml structure, check to see if the <code>compose-override.yml</code> has a value set.</li>
<li>Output the final file to the main directory, calling it <code>docker-compose.yml</code>.</li>
</ol>
<h2 id="a-word-of-caution">A word of caution</h2>
<p>If you specify an override for a service, and then rebuild the <code>docker-compose.yml</code> file, but deselect the service from the list, then the YAML merging will still produce that override.</p>
<p>For example, lets say NodeRed was selected to have have the following override specified in <code>compose-override.yml</code>:</p>
<pre><code>services:
  nodered:
    restart: always
</code></pre>
<p>When rebuilding the menu, ensure to have NodeRed service always included because if it's no longer included, the only values showing in the final <code>docker-compose.yml</code> file for NodeRed will be the <code>restart</code> key and its value. Docker Compose will error with the following message:</p>
<pre><code>Service nodered has neither an image nor a build context specified. At least one must be provided.
</code></pre>
<p>When attempting to bring the services up with <code>docker-compose up -d</code>.</p>
<p>Either remove the override for NodeRed in <code>compose-override.yml</code> and rebuild the stack, or ensure that NodeRed is built with the stack to fix this.</p>
<h2 id="examples">Examples</h2>
<h3 id="overriding-default-settings">Overriding default settings</h3>
<p>Lets assume you put the following into the <code>compose-override.yml</code> file:</p>
<pre><code>services:
  mosquitto:
    ports:
      - 1996:1996
      - 9001:9001
</code></pre>
<p>Normally the mosquitto service would be built like this inside the <code>docker-compose.yml</code> file:</p>
<pre><code>version: '3.6'
services:
  mosquitto:
    container_name: mosquitto
    image: eclipse-mosquitto
    restart: unless-stopped
    user: &quot;1883&quot;
    ports:
      - 1883:1883
      - 9001:9001
    volumes:
      - ./volumes/mosquitto/data:/mosquitto/data
      - ./volumes/mosquitto/log:/mosquitto/log
      - ./volumes/mosquitto/pwfile:/mosquitto/pwfile
      - ./services/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
      - ./services/mosquitto/filter.acl:/mosquitto/config/filter.acl
</code></pre>
<p>Take special note of the ports list.</p>
<p>If you run the build script with the <code>compose-override.yml</code> file in place, and open up the final <code>docker-compose.yml</code> file, you will notice that the port list have been replaced with the ones you specified in the <code>compose-override.yml</code> file.</p>
<pre><code>version: '3.6'
services:
  mosquitto:
    container_name: mosquitto
    image: eclipse-mosquitto
    restart: unless-stopped
    user: &quot;1883&quot;
    ports:
      - 1996:1996
      - 9001:9001
    volumes:
      - ./volumes/mosquitto/data:/mosquitto/data
      - ./volumes/mosquitto/log:/mosquitto/log
      - ./volumes/mosquitto/pwfile:/mosquitto/pwfile
      - ./services/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
      - ./services/mosquitto/filter.acl:/mosquitto/config/filter.acl
</code></pre>
<p>Do note that it will replace the entire list, if you were to specify</p>
<pre><code>services:
  mosquitto:
    ports:
      - 1996:1996
</code></pre>
<p>Then the final output will be:</p>
<pre><code>version: '3.6'
services:
  mosquitto:
    container_name: mosquitto
    image: eclipse-mosquitto
    restart: unless-stopped
    user: &quot;1883&quot;
    ports:
      - 1996:1996
    volumes:
      - ./volumes/mosquitto/data:/mosquitto/data
      - ./volumes/mosquitto/log:/mosquitto/log
      - ./volumes/mosquitto/pwfile:/mosquitto/pwfile
      - ./services/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
      - ./services/mosquitto/filter.acl:/mosquitto/config/filter.acl
</code></pre>
<h3 id="using-env-files-instead-of-docker-compose-variables">Using env files instead of docker-compose variables</h3>
<p>If you need or prefer to use *.env files for docker-compose environment variables in a separate file instead of using overrides, you can do so like this:</p>
<pre><code>services:
  grafana:
    env_file:
      - ./services/grafana/grafana.env
    environment:
</code></pre>
<p>This will remove the default environment variables set in the template, and tell docker-compose to use the variables specified in your file. It is not mandatory that the <em>.env file be placed in the service's service directory, but is strongly suggested. Keep in mind the <a href="https://sensorsiot.github.io/IOTstack/PostBuild-Script">PostBuild Script</a> functionality to automatically copy your </em>.env files into their directories on successful build if you need to.</p>
<h3 id="adding-custom-services">Adding custom services</h3>
<p>Custom services can be added in a similar way to overriding default settings for standard services. Lets add a Minecraft and rcon server to IOTstack.
Firstly, put the following into <code>compose-override.yml</code>:</p>
<pre><code>services:
  mosquitto:
    ports:
      - 1996:1996
      - 9001:9001
  minecraft:
    image: itzg/minecraft-server
    ports:
      - &quot;25565:25565&quot;
    volumes:
      - &quot;./volumes/minecraft:/data&quot;
    environment:
      EULA: &quot;TRUE&quot;
      TYPE: &quot;PAPER&quot;
      ENABLE_RCON: &quot;true&quot;
      RCON_PASSWORD: &quot;PASSWORD&quot;
      RCON_PORT: 28016
      VERSION: &quot;1.15.2&quot;
      REPLACE_ENV_VARIABLES: &quot;TRUE&quot;
      ENV_VARIABLE_PREFIX: &quot;CFG_&quot;
      CFG_DB_HOST: &quot;http://localhost:3306&quot;
      CFG_DB_NAME: &quot;IOTstack Minecraft&quot;
      CFG_DB_PASSWORD_FILE: &quot;/run/secrets/db_password&quot;
    restart: unless-stopped
  rcon:
    image: itzg/rcon
    ports:
      - &quot;4326:4326&quot;
      - &quot;4327:4327&quot;
    volumes:
      - &quot;./volumes/rcon_data:/opt/rcon-web-admin/db&quot;
secrets:
  db_password:
    file: ./db_password
</code></pre>
<p>Then create the service directory that the new instance will use to store persistant data:</p>
<p><code>mkdir -p ./volumes/minecraft</code></p>
<p>and</p>
<p><code>mkdir -p ./volumes/rcon_data</code></p>
<p>Obviously you will need to give correct folder names depending on the <code>volumes</code> you specify for your custom services. If your new service doesn't require persistant storage, then you can skip this step.</p>
<p>Then simply run the <code>./menu.sh</code> command, and rebuild the stack with what ever services you had before.</p>
<p>Using the Mosquitto example above, the final <code>docker-compose.yml</code> file will look like:</p>
<pre><code>version: '3.6'
services:
  mosquitto:
    ports:
    - 1996:1996
    - 9001:9001
    container_name: mosquitto
    image: eclipse-mosquitto
    restart: unless-stopped
    user: '1883'
    volumes:
    - ./volumes/mosquitto/data:/mosquitto/data
    - ./volumes/mosquitto/log:/mosquitto/log
    - ./services/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf
    - ./services/mosquitto/filter.acl:/mosquitto/config/filter.acl
  minecraft:
    image: itzg/minecraft-server
    ports:
    - 25565:25565
    volumes:
    - ./volumes/minecraft:/data
    environment:
      EULA: 'TRUE'
      TYPE: PAPER
      ENABLE_RCON: 'true'
      RCON_PASSWORD: PASSWORD
      RCON_PORT: 28016
      VERSION: 1.15.2
      REPLACE_ENV_VARIABLES: 'TRUE'
      ENV_VARIABLE_PREFIX: CFG_
      CFG_DB_HOST: http://localhost:3306
      CFG_DB_NAME: IOTstack Minecraft
      CFG_DB_PASSWORD_FILE: /run/secrets/db_password
    restart: unless-stopped
  rcon:
    image: itzg/rcon
    ports:
    - 4326:4326
    - 4327:4327
    volumes:
    - ./volumes/rcon_data:/opt/rcon-web-admin/db
secrets:
  db_password:
    file: ./db_password
</code></pre>
<p>Do note that the order of the YAML keys is not guaranteed.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../Contributing-Services/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Contributing a service to IOTstack
            </div>
          </div>
        </a>
      
      
        <a href="../Default-Configs/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Build Stack Default Passwords for Services
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.7353b375.min.js"></script>
      
    
  </body>
</html>